#!/usr/bin/env bash

DIR="$HOME/.config/bspwm"
rofi_command="rofi -theme $DIR/rofi/themes/network.rasi"

## Get info
IFACE="$(nmcli | grep -i interface | awk '/interface/ {print $2}')"
STATUS="$(nmcli radio wifi)"

active=""
urgent=""

if (ping -c 1 archlinux.org || ping -c 1 google.com || ping -c 1 github.com || ping -c 1 sourceforge.net) &>/dev/null; then
    if [[ $STATUS == *"enable"* ]]; then
        if [[ $IFACE == e* ]]; then
            connected=""
        else
            connected=""
        fi
    active="-a 0"
    SSID="$(iwgetid -r)"
    PIP="$(nmcli -t -f name,device connection show --active | grep wlp1s0 | cut -d\: -f1)"
    fi
else
    urgent="-u 0"
    SSID="Disconnected"
    PIP=""
    connected=""
fi

## Icons
launch_cli=""

options="$connected\n$launch_cli"

## Main
chosen="$(echo -e "$options" | $rofi_command -p "$SSID$PIP" -dmenu $active $urgent -selected-row 1)"
case $chosen in
    $connected)
        if [[ $STATUS == *"enable"* ]]; then
            nmcli radio wifi off
        else
            nmcli radio wifi on
        fi 
        ;;
    $launch_cli)
        alacritty --class 'alacritty-float,alacritty-float' --config-file ~/.config/alacritty/alacritty.yml -e nmtui
        ;;
esac
